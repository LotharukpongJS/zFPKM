---
title: "Introduction to zFPKM Transformation"
author: "Ron Ammar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Summary

Perform the zFPKM transform on RNA-seq FPKM data. This algorithm is based on the publication by [Hart et al., 2013 
(Pubmed ID 24215113)](https://www.ncbi.nlm.nih.gov/pubmed/24215113). The reference recommends using zFPKM > -3 to select 
expressed genes. Validated with ENCODE open/closed promoter chromatin structure epigenetic data on six of the ENCODE 
cell lines. It works well for gene level data using FPKM or TPM, but does not appear to calibrate well for transcript level 
data.

## Identifying *active* genes

We calculate zFPKM for existing FPKM from [GSE96106](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE96106).

```{r}
library(dplyr)
library(GEOquery)
library(stringr)

esetlist <- getGEO("GSE96106")
suppFiles <- getGEOSuppFiles("GSE96106")
fileNames <- rownames(suppFiles)

doe <- pData(esetlist[[1]])
fpkm <- read.delim(gzfile(fileNames[which(str_detect(fileNames, "fpkm"))]))
counts <- read.delim(gzfile(fileNames[which(str_detect(fileNames, "count.matrix"))]))
```

The `zFPKMTransformDF` function also optionally  plots the Guassian fit to the FPKM data for which the z-scores are based.

```{r}
library(zFPKM)
zfpkm <- zFPKMTransformDF(fpkm)
```

To determine which genes are *active* across *all* samples, we use `rowMeans()` and a zFPKM cutoff of -3, as suggested
by the authors.

```{r}
activeGenes <- which(rowMeans(zfpkm) > -3)
```


### References

Hart T, Komori HK, LaMere S, Podshivalova K, Salomon DR. Finding the active genes in deep RNA-seq gene expression 
studies. BMC Genomics. 2013 Nov 11;14:778. doi: 10.1186/1471-2164-14-778.


```{r}
sessionInfo()
```